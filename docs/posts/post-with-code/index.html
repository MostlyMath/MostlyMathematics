<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-09-10">

<title>The Birkhoff’s Ergodic Theorem – Mostly Mathematics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-96c1bb8b336142dcc39f931773fab1b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mostly Mathematics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts/fifth post/index.html">Posts</a></li><li class="breadcrumb-item"><a href="../../posts/post-with-code/index.html">The Birkhoff’s Ergodic Theorem</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts/fifth post/index.html">Posts</a></li><li class="breadcrumb-item"><a href="../../posts/post-with-code/index.html">The Birkhoff’s Ergodic Theorem</a></li></ol></nav>
      <h1 class="title">The Birkhoff’s Ergodic Theorem</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Analysis</div>
                <div class="quarto-category">Dynamics</div>
                <div class="quarto-category">Ergodic Theory</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 10, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Posts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/fifth post/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamics of irrational rotations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/fourth post/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reproducing Kernel Hilbert Spaces - An Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/my-first-post/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poincaré Recurrence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/post-with-code/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">The Birkhoff’s Ergodic Theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/welcome/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Positive Definite Kernels</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>The ergodic theorem was proved in 1931, first by John von Neumann in the case of <span class="math inline">\({\mathcal{L}}^2\)</span> convergence and then by Birkhoff in the much stronger case of pointwise convergence which solved the most fundamental question in statistical mechanics: when does the time average converge to the space average? Before getting into this let us think about what <a href="\posts\my-first-post#poincaré’s-recurrence-theorem">Poincaré Recurrence</a> gave us:</p>
<blockquote class="blockquote">
<p>Let <span class="math inline">\(T : \mathcal{X} \to \mathcal{X}\)</span> be a measure-preserving transformation of a probability space <span class="math inline">\((\mathcal{X}, \beta, \mu)\)</span>. Let <span class="math inline">\(\mathcal{E} \in \beta\)</span> with <span class="math inline">\(m(\mathcal{E}) &gt; 0\)</span>. Then almost all points of <span class="math inline">\(\mathcal{E}\)</span> return infinitely often to <span class="math inline">\(\mathcal{E}\)</span> under positive iteration by <span class="math inline">\(T\)</span> (i.e., there exists <span class="math inline">\(\mathcal{F} \subseteq \mathcal{E}\)</span> with <span class="math inline">\(m(\mathcal{F}) = m(\mathcal{E})\)</span> such that for each <span class="math inline">\(x \in \mathcal{F}\)</span> there is a sequence <span class="math inline">\(n_1 &lt; n_2 &lt; n_3 &lt; \cdots\)</span> of natural numbers with <span class="math inline">\(T^{n_i}(x) \in \mathcal{F}\)</span> for each <span class="math inline">\(i\)</span>).</p>
</blockquote>
<p>So, if we have a <a href="\posts\my-first-post#measure-preserving-systems">measure preserving system</a>, then we can take a measurable set <span class="math inline">\(\mathcal{E}\)</span> with a point <span class="math inline">\(x \in \mathcal{E}\)</span> which returns infinitely often to <span class="math inline">\(\mathcal{E}\)</span>. Poincaré Recurrence guarantees the existence of such a point. What we want to find now is in some sense: the frequency of the occurence of the points of the orbit of <span class="math inline">\(x\)</span> in <span class="math inline">\(\mathcal{E}\)</span>.</p>
<p>Let <span class="math inline">\(\mathcal{O}(x) = \{ x, T(x), T^2(x), \dots \}\)</span> be the orbit of <span class="math inline">\(x \in \mathcal{E}\)</span>. Let <span class="math inline">\(\mathcal{O}_N(x) := \{ x, \dots , T^{N-1}(x) \}\)</span></p>
<p>The frequency of the number of points of <span class="math inline">\(\mathcal{O}_N(x)\)</span> that are also in <span class="math inline">\(E\)</span> can be represented as follows: <span class="math display">\[ \frac{1}{N} \sum_{i=0}^{N-1} X_E(T^i(x)), \]</span> where <span class="math inline">\(X_E\)</span> is the characteristic function of <span class="math inline">\(E\)</span>. Now what would happen if <span class="math inline">\(N\)</span> keeps increasing? Consider the following limit: <span class="math display">\[ \lim_{N \to \infty} \frac{1}{N} \sum_{i=0}^{N-1} X_E(T^i(x)) \]</span> Some questions we may have are: Will such a limit exist in the first place? Under what condidtions can such a limit exist? Incase it does, what can it possibly converge to?</p>
<p>Let us genralize our problem to an arbitary measurable or integrable function <span class="math inline">\(f\)</span> instead of the characteristic function and call the limit the time average. So now we want to know what could possibly happen to <span class="math display">\[ \lim_{N \to \infty} \frac{1}{N} \sum_{i=0}^{N-1} f(T^i(x)) \]</span></p>
<p>Boltzmann (in a very physics pov perhaps) hypothesized that the time average converges to the space average which is <span class="math inline">\(\int f d\mu\)</span>. This is not quite true always which leads us to the Birkhoff’s ergodic theorem which says that in the case of an ergodic system, the time average converges to the space average. Let us first understand what an ergodic transformation is.</p>
</section>
<section id="ergodicity" class="level3">
<h3 class="anchored" data-anchor-id="ergodicity">Ergodicity</h3>
<p>Ergodicity formalizes the idea of when a dynamical system cannot be broken down into smaller invariant pieces with positive measure. Let us first see what an invariant set is:</p>
<blockquote class="blockquote">
<p>Let <span class="math inline">\(T: \mathcal{X} \rightarrow \mathcal{X}\)</span> be a transformation. A subset <span class="math inline">\(\mathcal{B}\)</span> of <span class="math inline">\(\mathcal{X}\)</span> is <strong>invariant</strong> under <span class="math inline">\(T\)</span> if <span class="math inline">\(T^{-1}(\mathcal{B})=\mathcal{B}\)</span>.</p>
</blockquote>
<p>Note that <span class="math inline">\(T\)</span> need not be invertible here. <span class="math inline">\(T^{-1}(\mathcal{B})\)</span> just refers to all the points in <span class="math inline">\(\mathcal{X}\)</span> that <span class="math inline">\(T\)</span> takes to <span class="math inline">\(\mathcal{B}\)</span>. Now we can define what an ergodic transformation is.</p>
<blockquote class="blockquote">
<p>A measure preserving transformation T on a probability space is <strong>ergodic</strong> if for every <span class="math inline">\(T\)</span>-invariant set <span class="math inline">\(\mathcal{B}\)</span> in <span class="math inline">\(\beta\)</span>, either <span class="math inline">\(\mu(\mathcal{B})=0\)</span> or <span class="math inline">\(\mu(\mathcal{B})=1\)</span>.</p>
</blockquote>
<p>In other words, the system is measure-theoretically indecomposable i.e: any invariant set is either negligible or occupies the whole space.</p>
<p><strong>Example:</strong> Consider a rational rotation on the following set <span class="math inline">\(\mathcal{A}\)</span> in <span class="math inline">\(\mathbb{R}/\mathbb{Z}\)</span>. <span class="math display">\[
\mathcal{A} = \bigcup_{i=0}^{q-1} \left[ \frac{i}{q},\frac{i}{q}+\frac{1}{2q}\right].
\]</span> This set is invariant under <span class="math inline">\(R_\alpha\)</span> as it sends each interval in <span class="math inline">\(\mathcal{A}\)</span> into another one in <span class="math inline">\(\mathcal{A}\)</span> itself but the measure of this set lies between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> making it non-ergodic. Turns out, irrational rotations are ergodic which we will probably look into in another post (along with more consequences of ergodicity).</p>
<p>We are now ready to state the Birkhoff’s ergodic theorem. Note that we restrict ourselves to a probability space since any finite measure space can be normalized accordingly.</p>
</section>
<section id="the-birkhoffs-ergodic-theorem" class="level3">
<h3 class="anchored" data-anchor-id="the-birkhoffs-ergodic-theorem">The Birkhoff’s Ergodic Theorem</h3>
<blockquote class="blockquote">
<p>Let <span class="math inline">\((\mathcal{X},\beta,\mu)\)</span> be a probability space and let <span class="math inline">\(T\)</span> be an ergodic transformation on <span class="math inline">\((\mathcal{X},\beta,\mu)\)</span>. If <span class="math inline">\(f: \mathcal{X} \to \mathbb{R}\)</span> is an integrable function, then for <span class="math inline">\(\mu\)</span>-a.e <span class="math inline">\(x \in \mathcal{X}\)</span> <span class="math display">\[
\lim_{n \to \infty} \frac{1}{n} \sum_{i=0}^{n-1} f(T^i(x)) = \int f d\mu
\]</span></p>
</blockquote>
</section>
<section id="can-ergodicity-be-relaxed" class="level3">
<h3 class="anchored" data-anchor-id="can-ergodicity-be-relaxed">Can ergodicity be relaxed?</h3>
<p>Now, what happens if we do not have an ergodic system? Turns out, in the case of measure-preserving systems, the time average does converge, not to the space average, but to a <span class="math inline">\(T\)</span>-invariant function as stated below and we can also very easily find the integral of this limit function.</p>
<blockquote class="blockquote">
<p>Let <span class="math inline">\((\mathcal{X},\beta,\mu)\)</span> be a probability space and let <span class="math inline">\(T\)</span> be a measure-preserving transformation on <span class="math inline">\((\mathcal{X},\beta,\mu)\)</span>. If <span class="math inline">\(f: \mathcal{X} \to \mathbb{R}\)</span> is an integrable function, then</p>
</blockquote>
<blockquote class="blockquote">
<ol type="1">
<li><span class="math inline">\(\lim_{n \to \infty} \frac{1}{n} \sum_{i=0}^{n-1} f(T^i(x))\)</span> exists for a.e <span class="math inline">\(x \in \mathcal{X}\)</span>. Denote this limit by <span class="math inline">\(\bar{f}(x)\)</span>.<br>
</li>
<li><span class="math inline">\(\bar{f}(Tx) = \bar{f}(x)\)</span> a.e.<br>
</li>
<li>For any measurable set <span class="math inline">\(\mathcal{A}\)</span> that is <span class="math inline">\(T\)</span>-invariant,<br>
<span class="math display">\[\begin{equation*}
\int_{\mathcal{A}} f d\mu = \int_{\mathcal{A}} \bar{f} d\mu.
\end{equation*}\]</span></li>
</ol>
</blockquote>
<p>The proof is quite lengthy and I am skipping it here. One can refer to <span class="citation" data-cites="silva2008">(<a href="#ref-silva2008" role="doc-biblioref">Silva 2008</a>)</span> for a beginner-friendly proof. One can also refer to <span class="citation" data-cites="assani2003wiener">(<a href="#ref-assani2003wiener" role="doc-biblioref">Assani 2003</a>)</span> which has 3 very interesting proofs (one using the maximal inequality, one using a combinatorial argument and the last using a variational inequality) which are a little advanced.</p>
<div class="comment-section">
<!-- Giscus comments widget -->
<script src="https://giscus.app/client.js" data-repo="MostlyMath/MostlyMathematics" data-repo-id="R_kgDOPrVY4w" data-category="Comments" data-category-id="DIC_kwDOPrVY484CvwcT" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-assani2003wiener" class="csl-entry" role="listitem">
Assani, Idris. 2003. <em>Wiener Wintner Ergodic Theorems</em>. River Edge, NJ: World Scientific.
</div>
<div id="ref-silva2008" class="csl-entry" role="listitem">
Silva, César E. 2008. <em>Invitation to Ergodic Theory</em>. Vol. 42. Student Mathematical Library. Providence, RI: American Mathematical Society.
</div>
<div id="ref-walters1982" class="csl-entry" role="listitem">
Walters, Peter. 1982. <em>An Introduction to Ergodic Theory</em>. Vol. 79. Graduate Texts in Mathematics. New York: Springer-Verlag.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>